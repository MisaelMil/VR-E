<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz VR com Tela Inicial</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <style> body { margin: 0; background: #000; } </style>

  <script>
    /* --- Componente para girar objetos lentamente --- */
    AFRAME.registerComponent('rotate', {
      schema: { speed: { type: 'number', default: 0.3 } },
      tick: function (time, deltaTime) {
        this.el.object3D.rotation.y += (deltaTime / 1000) * this.data.speed;
      }
    });

    /* --- Componente para recentralizar visão com animação suave --- */
    AFRAME.registerComponent("smooth-look-reset", {
      schema: { duration: { type: "number", default: 800 } }, // ms
      init: function () {
        this.startRotation = null;
        this.startTime = null;
        this.animating = false;
      },
      tick: function (time, delta) {
        if (!this.animating) return;
        if (this.startTime === null) this.startTime = time;
        const progress = Math.min((time - this.startTime) / this.data.duration, 1);
        const ease = 0.5 - 0.5 * Math.cos(progress * Math.PI); // easing suave
        this.el.object3D.rotation.x = THREE.MathUtils.lerp(this.startRotation.x, 0, ease);
        this.el.object3D.rotation.y = THREE.MathUtils.lerp(this.startRotation.y, 0, ease);
        if (progress >= 1) this.animating = false;
      },
      reset: function () {
        this.startRotation = this.el.object3D.rotation.clone();
        this.startTime = null;
        this.animating = true;
      }
    });
  </script>
</head>
<body>
<a-scene>
  <!-- Câmera + cursor -->
  <a-entity id="cameraRig" position="0 1.6 0">
    <a-camera id="camera" look-controls smooth-look-reset>
      <a-cursor id="cursor"
                fuse="true"
                fuse-timeout="1500"
                color="yellow"
                raycaster="objects: .clickable">
      </a-cursor>

      <!-- HUD placar (invisível até quiz começar) -->
      <a-entity id="scoreLabel"
                text="value: Placar: 0; align: left; color: yellow; width: 2"
                position="-1.2 0.8 -1.5"
                visible="false">
      </a-entity>
    </a-camera>
  </a-entity>

  <!-- ====== TELA INICIAL COM SÓLIDOS ====== -->
  <a-entity id="tela-inicial">
    <!-- Objetos em fila -->
    <a-entity position="-4 2 -5">
      <a-entity geometry="primitive: tetrahedron" material="color: #FF0000; opacity: 0.5" rotate></a-entity>
      <a-text value="Tetraedro" align="center" position="0 -1 0" color="white"></a-text>
    </a-entity>
    <a-entity position="-2 2 -5">
      <a-entity geometry="primitive: box" material="color: #00FF00; opacity: 0.5" rotate></a-entity>
      <a-text value="Cubo" align="center" position="0 -1 0" color="white"></a-text>
    </a-entity>
    <a-entity position="0 2 -5">
      <a-entity geometry="primitive: octahedron" material="color: #0000FF; opacity: 0.5" rotate></a-entity>
      <a-text value="Octaedro" align="center" position="0 -1 0" color="white"></a-text>
    </a-entity>
    <a-entity position="2 2 -5">
      <a-entity geometry="primitive: dodecahedron" material="color: #FFFF00; opacity: 0.5" rotate></a-entity>
      <a-text value="Dodecaedro" align="center" position="0 -1 0" color="white"></a-text>
    </a-entity>
    <a-entity position="4 2 -5">
      <a-entity geometry="primitive: icosahedron" material="color: #FF00FF; opacity: 0.5" rotate></a-entity>
      <a-text value="Icosaedro" align="center" position="0 -1 0" color="white"></a-text>
    </a-entity>

    <!-- Botão inicial -->
    <a-entity id="startButtonEntity" position="0 0 -3">
      <a-box id="startBox" class="clickable"
             color="#4CAF50" depth="0.2" height="0.6" width="2">
      </a-box>
      <a-entity text="value: Iniciar Quiz; align:center; color:#fff; width:2"
                position="0 0 0.11"></a-entity>
    </a-entity>
  </a-entity>

  <!-- ====== QUIZ (inicialmente oculto) ====== -->
  <a-entity id="quiz-container" position="0 2.9 -4" visible="false">
    <a-image id="pergunta-img" position="0 1.5 0" width="3.5" height="1.2"></a-image>
    <a-entity id="opcoes" position="0 -0.5 0"></a-entity>
    <a-entity id="feedbackLabel"
      text="value: ; align: center; color: white; width: 3"
      position="0 -2 0">
    </a-entity>
  </a-entity>
</a-scene>

<script>
  const quiz = [
    { perguntaImg: "figpage/pergunta1.png", opcoes: [
      {img:"figpage/q1a.png", resposta:"Quadrado"},
      {img:"figpage/q1b.png", resposta:"Triângulo"},
      {img:"figpage/q1c.png", resposta:"Círculo"},
      {img:"figpage/q1d.png", resposta:"Cubo"} ], correta: "Cubo" },
    { perguntaImg: "figpage/pergunta2.png", opcoes: [
      {img:"figpage/q2a.png", resposta:"4"},
      {img:"figpage/q2b.png", resposta:"6"},
      {img:"figpage/q2c.png", resposta:"8"},
      {img:"figpage/q2d.png", resposta:"12"} ], correta: "6" }
    // ... continue com as demais perguntas ...
  ];

  const startBox = document.getElementById("startBox");
  const telaInicial = document.getElementById("tela-inicial");
  const quizContainer = document.getElementById("quiz-container");
  const perguntaImgEl = document.getElementById("pergunta-img");
  const opcoesEl = document.getElementById("opcoes");
  const feedbackLabel = document.getElementById("feedbackLabel");
  const scoreLabel = document.getElementById("scoreLabel");
  const camera = document.getElementById("camera");

  let perguntaAtual = 0;
  let score = 0;

  startBox.addEventListener("mouseenter", () => startBox.setAttribute("color", "#66d966"));
  startBox.addEventListener("mouseleave", () => startBox.setAttribute("color", "#4CAF50"));
  startBox.addEventListener("click", () => {
    telaInicial.setAttribute("visible", "false");
    quizContainer.setAttribute("visible", "true");
    scoreLabel.setAttribute("visible", "true");
    resetarVisao();
    carregarPergunta();
  });

  function carregarPergunta(){
    if (perguntaAtual >= quiz.length) { finalizarQuiz(); return; }
    const dados = quiz[perguntaAtual];

    perguntaImgEl.setAttribute("src", dados.perguntaImg);
    feedbackLabel.setAttribute("text", "value: ");
    opcoesEl.innerHTML = "";

    const positions = ["-1 0.5 0", "1 0.5 0", "-1 -0.8 0", "1 -0.8 0"];
    dados.opcoes.forEach((opcao, i) => {
      const img = document.createElement("a-image");
      img.setAttribute("src", opcao.img);
      img.setAttribute("width", "1.3");
      img.setAttribute("height", "1.3");
      img.setAttribute("position", positions[i]);
      img.setAttribute("class", "opcao clickable");
      img.addEventListener("click", () => verificarResposta(opcao.resposta, dados.correta));
      opcoesEl.appendChild(img);
    });

    scoreLabel.setAttribute("text", `value: Placar: ${score}`);
  }

  function verificarResposta(selecionada, correta){
    if(selecionada === correta){
      score++;
      scoreLabel.setAttribute("text", `value: Placar: ${score}`);
      feedbackLabel.setAttribute("text", "value: ✔ Correto!; color: lime");
      perguntaAtual++;
      resetarVisao();
      setTimeout(carregarPergunta, 1200);
    } else {
      feedbackLabel.setAttribute("text", "value: ✘ Incorreto!; color: red");
      resetarVisao();
    }
  }

  function finalizarQuiz(){
    perguntaImgEl.setAttribute("src", "figpage/final.png");
    opcoesEl.innerHTML = "";
    feedbackLabel.setAttribute("text", `value: Quiz finalizado! Placar: ${score}/${quiz.length}; color: yellow`);

    const btn = document.createElement("a-box");
    btn.setAttribute("color", "#4CAF50");
    btn.setAttribute("depth", "0.2");
    btn.setAttribute("height", "0.6");
    btn.setAttribute("width", "2");
    btn.setAttribute("position", "0 -3 0");
    btn.setAttribute("class", "reiniciar clickable");

    const txt = document.createElement("a-entity");
    txt.setAttribute("text", "value: Reiniciar; align: center; color: white; width: 3");
    txt.setAttribute("position", "0 0 0.12");
    btn.appendChild(txt);

    btn.addEventListener("click", reiniciarQuiz);
    opcoesEl.appendChild(btn);
  }

  function reiniciarQuiz(){
    perguntaAtual = 0;
    score = 0;
    scoreLabel.setAttribute("text", "value: Placar: 0");
    resetarVisao();
    carregarPergunta();
  }

  function resetarVisao(){
    camera.components["smooth-look-reset"].reset();
  }
</script>
</body>
</html>
